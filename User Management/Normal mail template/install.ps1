$PackageName = "NormalEmail-template"
$Version = 1

# Font Settings/Values Outlook
$ComposeFontComplex = "60,104,116,109,108,62,13,10,13,10,60,104,101,97,100,62,13,10,60,115,116,121,108,101,62,13,10,13,10,32,47,42,32,83,116,121,108,101,32,68,101,102,105,110,105,116,105,111,110,115,32,42,47,13,10,32,115,112,97,110,46,80,101,114,115,110,108,105,99,104,101,114,69,114,115,116,101,108,108,115,116,105,108,13,10,9,123,109,115,111,45,115,116,121,108,101,45,110,97,109,101,58,34,80,101,114,115,246,110,108,105,99,104,101,114,32,69,114,115,116,101,108,108,115,116,105,108,34,59,13,10,9,109,115,111,45,115,116,121,108,101,45,116,121,112,101,58,112,101,114,115,111,110,97,108,45,99,111,109,112,111,115,101,59,13,10,9,109,115,111,45,115,116,121,108,101,45,110,111,115,104,111,119,58,121,101,115,59,13,10,9,109,115,111,45,115,116,121,108,101,45,117,110,104,105,100,101,58,110,111,59,13,10,9,109,115,111,45,97,110,115,105,45,102,111,110,116,45,115,105,122,101,58,49,48,46,48,112,116,59,13,10,9,109,115,111,45,98,105,100,105,45,102,111,110,116,45,115,105,122,101,58,49,49,46,48,112,116,59,13,10,9,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,44,115,97,110,115,45,115,101,114,105,102,59,13,10,9,109,115,111,45,97,115,99,105,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,59,13,10,9,109,115,111,45,104,97,110,115,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,59,13,10,9,109,115,111,45,98,105,100,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,84,105,109,101,115,32,78,101,119,32,82,111,109,97,110,34,59,13,10,9,109,115,111,45,98,105,100,105,45,116,104,101,109,101,45,102,111,110,116,58,109,105,110,111,114,45,98,105,100,105,59,13,10,9,99,111,108,111,114,58,35,53,57,53,57,53,57,59,125,13,10,45,45,62,13,10,60,47,115,116,121,108,101,62,13,10,60,47,104,101,97,100,62,13,10,13,10,60,47,104,116,109,108,62,13,10"
$ComposeFontSimple = "60,0,0,0,31,0,0,248,0,0,0,0,200,0,0,0,0,0,0,0,89,89,89,0,0,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"
$ReplyFontComplex = "60,104,116,109,108,62,13,10,13,10,60,104,101,97,100,62,13,10,60,115,116,121,108,101,62,13,10,13,10,32,47,42,32,83,116,121,108,101,32,68,101,102,105,110,105,116,105,111,110,115,32,42,47,13,10,32,115,112,97,110,46,80,101,114,115,110,108,105,99,104,101,114,69,114,115,116,101,108,108,115,116,105,108,13,10,9,123,109,115,111,45,115,116,121,108,101,45,110,97,109,101,58,34,80,101,114,115,246,110,108,105,99,104,101,114,32,69,114,115,116,101,108,108,115,116,105,108,34,59,13,10,9,109,115,111,45,115,116,121,108,101,45,116,121,112,101,58,112,101,114,115,111,110,97,108,45,99,111,109,112,111,115,101,59,13,10,9,109,115,111,45,115,116,121,108,101,45,110,111,115,104,111,119,58,121,101,115,59,13,10,9,109,115,111,45,115,116,121,108,101,45,117,110,104,105,100,101,58,110,111,59,13,10,9,109,115,111,45,97,110,115,105,45,102,111,110,116,45,115,105,122,101,58,49,48,46,48,112,116,59,13,10,9,109,115,111,45,98,105,100,105,45,102,111,110,116,45,115,105,122,101,58,49,49,46,48,112,116,59,13,10,9,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,44,115,97,110,115,45,115,101,114,105,102,59,13,10,9,109,115,111,45,97,115,99,105,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,59,13,10,9,109,115,111,45,104,97,110,115,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,59,13,10,9,109,115,111,45,98,105,100,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,84,105,109,101,115,32,78,101,119,32,82,111,109,97,110,34,59,13,10,9,109,115,111,45,98,105,100,105,45,116,104,101,109,101,45,102,111,110,116,58,109,105,110,111,114,45,98,105,100,105,59,13,10,9,99,111,108,111,114,58,35,53,57,53,57,53,57,59,125,13,10,45,45,62,13,10,60,47,115,116,121,108,101,62,13,10,60,47,104,101,97,100,62,13,10,13,10,60,47,104,116,109,108,62,13,10"
$ReplyFontSimple = "60,0,0,0,31,0,0,248,0,0,0,0,200,0,0,0,0,0,0,0,89,89,89,0,0,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"
$TextFontComplex = "60,104,116,109,108,62,13,10,13,10,60,104,101,97,100,62,13,10,60,115,116,121,108,101,62,13,10,13,10,32,47,42,32,83,116,121,108,101,32,68,101,102,105,110,105,116,105,111,110,115,32,42,47,13,10,32,115,112,97,110,46,80,101,114,115,110,108,105,99,104,101,114,69,114,115,116,101,108,108,115,116,105,108,13,10,9,123,109,115,111,45,115,116,121,108,101,45,110,97,109,101,58,34,80,101,114,115,246,110,108,105,99,104,101,114,32,69,114,115,116,101,108,108,115,116,105,108,34,59,13,10,9,109,115,111,45,115,116,121,108,101,45,116,121,112,101,58,112,101,114,115,111,110,97,108,45,99,111,109,112,111,115,101,59,13,10,9,109,115,111,45,115,116,121,108,101,45,110,111,115,104,111,119,58,121,101,115,59,13,10,9,109,115,111,45,115,116,121,108,101,45,117,110,104,105,100,101,58,110,111,59,13,10,9,109,115,111,45,97,110,115,105,45,102,111,110,116,45,115,105,122,101,58,49,48,46,48,112,116,59,13,10,9,109,115,111,45,98,105,100,105,45,102,111,110,116,45,115,105,122,101,58,49,49,46,48,112,116,59,13,10,9,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,44,115,97,110,115,45,115,101,114,105,102,59,13,10,9,109,115,111,45,97,115,99,105,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,59,13,10,9,109,115,111,45,104,97,110,115,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,34,59,13,10,9,109,115,111,45,98,105,100,105,45,102,111,110,116,45,102,97,109,105,108,121,58,34,84,105,109,101,115,32,78,101,119,32,82,111,109,97,110,34,59,13,10,9,109,115,111,45,98,105,100,105,45,116,104,101,109,101,45,102,111,110,116,58,109,105,110,111,114,45,98,105,100,105,59,13,10,9,99,111,108,111,114,58,35,53,57,53,57,53,57,59,125,13,10,45,45,62,13,10,60,47,115,116,121,108,101,62,13,10,60,47,104,101,97,100,62,13,10,13,10,60,47,104,116,109,108,62,13,10"
$TextFontSimple = "60,0,0,0,31,0,0,248,0,0,0,0,200,0,0,0,0,0,0,0,89,89,89,0,0,34,67,101,110,116,117,114,121,32,71,111,116,104,105,99,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"
#######################################################################################################################################
#   Get the RegValues
#######################################################################################################################################
<# 
$($(Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings").ComposeFontComplex -join ",")
$($(Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings").ComposeFontSimple -join ",")
$($(Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings").ReplyFontComplex -join ",")
$($(Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings").ReplyFontSimple -join ",")
$($(Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings").TextFontComplex -join ",")
$($(Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings").TextFontSimple -join ",")
#>


# Transcript for local log
$Path_local = "$ENV:LOCALAPPDATA\_MEM"
Start-Transcript -Path "$Path_local\Log\$PackageName-install.log" -Force
$ErrorActionPreference = "Stop"

#######################################################################################################################################
#   Font Settings
#######################################################################################################################################
$Path = "HKCU:\Software\Microsoft\Office\16.0\Common\MailSettings" 
if(!(Test-Path $Path)){New-Item -Path $Path -Force}

if($ComposeFontComplex){Set-ItemProperty -Path $Path -Name "ComposeFontComplex" -Value ([byte[]]$($ComposeFontComplex.Split(',') | % { "$_"})) -Type "Binary"}
if($ComposeFontSimple){Set-ItemProperty -Path $Path -Name "ComposeFontSimple" -Value ([byte[]]$($ComposeFontSimple.Split(',') | % { "$_"})) -Type "Binary"}
if($ReplyFontComplex){Set-ItemProperty -Path $Path -Name "ReplyFontComplex" -Value ([byte[]]$($ReplyFontComplex.Split(',') | % { "$_"})) -Type "Binary"}
if($ReplyFontSimple){Set-ItemProperty -Path $Path -Name "ReplyFontSimple" -Value ([byte[]]$($ReplyFontSimple.Split(',') | % { "$_"})) -Type "Binary"}
if($TextFontComplex){Set-ItemProperty -Path $Path -Name "TextFontComplex" -Value ([byte[]]$($TextFontComplex.Split(',') | % { "$_"})) -Type "Binary"}
if($TextFontSimple){Set-ItemProperty -Path $Path -Name "TextFontSimple" -Value ([byte[]]$($TextFontSimple.Split(',') | % { "$_"})) -Type "Binary"}


#######################################################################################################################################
#   NormailEmail.dotm
#######################################################################################################################################

$NormalEmail_File = "$env:APPDATA\Microsoft\Templates\NormalEmail.dotm"

try{
    New-Item -Path "$env:APPDATA\Microsoft\Templates" -ItemType "Directory" -Force
    try{
        if(Test-Path $NormalEmail_File){Remove-Item -Path $NormalEmail_File -Force}
        Copy-Item 'NormalEmail.dotm' -Destination "$env:APPDATA\Microsoft\Templates\" -Recurse -Force
    }catch{
        Add-Type -AssemblyName PresentationFramework
        [System.Windows.MessageBox]::Show('Your Outlook needs an Update with a restart. Please press OK to restart Outlook')
        Get-Process Outlook | Stop-Process -Force
        Start-Sleep 5
        if(Test-Path $NormalEmail_File){Remove-Item -Path $NormalEmail_File -Force}
        Copy-Item 'NormalEmail.dotm' -Destination "$env:APPDATA\Microsoft\Templates\" -Recurse -Force
        Start-Process Outlook
    }
    # Validation file
    New-Item -Path "$Path_local\Validation\$PackageName" -ItemType "file" -Force -Value $Version
}catch{
    Write-Host "_____________________________________________________________________"
    Write-Host "ERROR"
    Write-Host "$_"
    Write-Host "_____________________________________________________________________"
}

Stop-Transcript
